<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harsh ❤️ Twinkle | Wedding Invitation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'royal-maroon': '#8B0000',
                        'gold': '#D4AF37',
                        'cream': '#FFF8DC',
                        'rose-gold': '#B76E79',
                    },
                    fontFamily: {
                        display: ['Playfair Display', 'serif'],
                        body: ['Cormorant Garamond', 'serif'],
                        sans: ['Montserrat', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Cormorant+Garamond:wght==300;400;600;700&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #FFF8DC 0%, #F5E6D3 100%);
            min-height: 100vh;
        }
        
        .royal-pattern {
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 0, 0, 0.05) 0%, transparent 50%);
        }
        
        .hero-title {
            font-size: clamp(2.5rem, 8vw, 5rem);
            line-height: 1.1;
            background: linear-gradient(135deg, #8B0000 0%, #B76E79 50%, #D4AF37 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .tab-button {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .tab-button::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, #D4AF37, #8B0000);
            transform: translateX(-50%);
            transition: width 0.3s ease;
        }
        
        .tab-button.active::before {
            width: 100%;
        }
        
        .ornament {
            background: linear-gradient(135deg, #D4AF37 0%, #F4E4C1 100%);
            clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%);
        }
        
        .countdown-box {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.05) 0%, rgba(212, 175, 55, 0.05) 100%);
            border: 2px solid rgba(212, 175, 55, 0.3);
            backdrop-filter: blur(10px);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            box-shadow: 0 8px 32px rgba(139, 0, 0, 0.1);
        }
        
        .floating {
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.3), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .video-overlay {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.1) 0%, transparent 50%, rgba(212, 175, 55, 0.1) 100%);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #D4AF37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }
        
        .btn-royal {
            background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
            transition: all 0.3s ease;
        }
        
        .btn-royal:hover {
            background: linear-gradient(135deg, #A52A2A 0%, #8B0000 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(139, 0, 0, 0.3);
        }
        
        .divider {
            position: relative;
            text-align: center;
            margin: 3rem 0;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 40%; 
            height: 2px;
            background: linear-gradient(90deg, transparent, #D4AF37, transparent);
        }
        
        .divider::before { left: 0; }
        .divider::after { right: 0; }
        
        /* New style to control the size of the TH logo */
        .th-logo {
            width: 80px; /* Increased size to 80px as requested */
            height: auto;
        }
    </style>
</head>
<body class="font-body">

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Configuration Constants
    const firebaseConfig = {
        apiKey: "AIzaSyDHFGGH0mvnE0w_qBXD3jorY9VgmUzXSFw",
        authDomain: "harsh-twinkle-2025-3781d-5080d.firebaseapp.com",
        projectId: "harsh-twinkle-2025-3781d-5080d",
        storageBucket: "harsh-twinkle-2025-3781d-5080d.firebasestorage.app",
        messagingSenderId: "39339487057",
        appId: "1:39339487057:web:c8185842450b7b2c666d70"
     };

    const ADMIN_EMAIL = "pareeku01@gmail.com";
    const WEDDING_DATE = new Date("November 30, 2025 19:30:00").getTime();
    const RSVP_DEADLINE = "October 30, 2025";
    // 2. Performance RSVP visibility deadline
    const PERFORMANCE_CUTOFF_DATE = new Date("October 25, 2025").getTime(); 

    let db, auth, currentUser;
    let guestResponses = [];
    const appId = firebaseConfig.appId;
    let currentLanguage = 'en'; // Default language

    // Language Mapping (4. Simple Hindi translation placeholder)
    const translations = {
        en: {
            invite: "You Are Invited To Celebrate",
            hero: "Harsh & Twinkle",
            message: "With hearts full of joy and gratitude, the **Pareek family** invite you to witness and bless the sacred union of **Harsh** with **Twinkle**. Your presence will make this celebration truly complete.",
            rsvp_tab: "RSVP",
            details_tab: "Itinerary & Dress Code",
            welcome: "Welcome",
            signin: "Please sign in to view the invitation and RSVP",
            // More translations would go here
        },
        hi: {
            invite: "आपको आमंत्रित किया जाता है",
            hero: "हर्ष और ट्विंकल",
            message: "अपार हर्ष और कृतज्ञता के साथ, **पारीक परिवार** आपको **हर्ष** और **ट्विंकल** के इस पवित्र मिलन का साक्षी बनने और आशीर्वाद देने के लिए आमंत्रित करता है। आपकी उपस्थिति इस उत्सव को वास्तव में पूर्ण कर देगी।",
            rsvp_tab: "आरएसवीपी",
            details_tab: "कार्यक्रम और वेशभूषा",
            welcome: "स्वागत है",
            signin: "निमंत्रण और RSVP देखने के लिए कृपया साइन इन करें",
            // More translations would go here
        }
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    db = getFirestore(app);
    auth = getAuth(app);
    
    // 4. Function to update all displayed content to the current language
    const updateLanguageContent = () => {
        const lang = currentLanguage;
        const t = translations[lang];

        // Update Header
        document.getElementById('invite-header').textContent = t.invite;
        document.getElementById('hero-title').textContent = t.hero;
        
        // Update Family Message
        const msgEl = document.getElementById('family-message-content');
        if (msgEl) {
            let htmlMsg = t.message.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            // Safely insert the dynamically styled names (Harsh and Twinkle remain styled)
            htmlMsg = htmlMsg.replace('**Harsh**', `<strong class="text-royal-maroon">Harsh</strong>`)
                             .replace('**Twinkle**', `<strong class="text-royal-maroon">Twinkle</strong>`)
                             .replace('**Pareek family**', `<strong class="text-royal-maroon">Pareek family</strong>`);
            msgEl.innerHTML = htmlMsg;
        }

        // Update Tab Buttons (force a UI refresh to update tab titles)
        updateUI(); 
    };

    // 4. Language Toggle Function
    window.toggleLanguage = () => {
        currentLanguage = currentLanguage === 'en' ? 'hi' : 'en';
        updateLanguageContent();
    };


    // Tab Management
    let activeTab = 'rsvp';
    
    window.switchTab = (tabName) => {
        activeTab = tabName;
        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active', 'text-royal-maroon', 'font-semibold');
            btn.classList.add('text-gray-600');
        });
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.add('hidden');
        });
        
        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        const activeButton = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
        activeButton.classList.add('active', 'text-royal-maroon', 'font-semibold');
        activeButton.classList.remove('text-gray-600');
    };

    // Countdown Timer
    const updateCountdown = () => {
        const now = new Date().getTime();
        const distance = WEDDING_DATE - now;
        const el = document.getElementById('countdown');
        
        if (!el) return;
        
        if (distance < 0) {
            el.innerHTML = `<div class="text-2xl font-display text-royal-maroon">✨ The Celebration Has Begun! ✨</div>`;
            return;
        }

        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

        el.innerHTML = `
            <div class="flex gap-4 justify-center flex-wrap">
                <div class="countdown-box rounded-2xl p-4 min-w-[80px]">
                    <div class="text-4xl font-display font-bold text-royal-maroon">${days}</div>
                    <div class="text-xs font-sans uppercase tracking-wider text-gray-600 mt-1">Days</div>
                </div>
                <div class="countdown-box rounded-2xl p-4 min-w-[80px]">
                    <div class="text-4xl font-display font-bold text-royal-maroon">${hours}</div>
                    <div class="text-xs font-sans uppercase tracking-wider text-gray-600 mt-1">Hours</div>
                </div>
                <div class="countdown-box rounded-2xl p-4 min-w-[80px]">
                    <div class="text-4xl font-display font-bold text-royal-maroon">${minutes}</div>
                    <div class="text-xs font-sans uppercase tracking-wider text-gray-600 mt-1">Minutes</div>
                </div>
                <div class="countdown-box rounded-2xl p-4 min-w-[80px]">
                    <div class="text-4xl font-display font-bold text-royal-maroon">${seconds}</div>
                    <div class="text-xs font-sans uppercase tracking-wider text-gray-600 mt-1">Seconds</div>
                </div>
            </div>
        `;
    };
    
    // Function to dynamically set the RSVP deadline date in the footer
    const setRsvpDeadline = () => {
        const deadlineEl = document.getElementById('rsvp-deadline');
        if (deadlineEl) {
            deadlineEl.textContent = `RSVP by ${RSVP_DEADLINE}`;
        }
    }


    setInterval(updateCountdown, 1000);

    // Authentication
    window.signInWithGoogle = async () => {
        const provider = new GoogleAuthProvider();
        try {
            await signInWithPopup(auth, provider);
        } catch (error) {
            console.error("Sign-in error:", error);
            console.log("Sign-in failed. Please try again.");
        }
    };

    window.signOutUser = async () => {
        await signOut(auth);
    };

    onAuthStateChanged(auth, (user) => {
        currentUser = user;
        updateUI();
        if (user) loadRsvps();
    });

    // Load RSVPs
    const loadRsvps = () => {
        const q = query(collection(db, 'artifacts', appId, 'public', 'data', 'wedding_rsvps'));
        onSnapshot(q, (snapshot) => {
            guestResponses = [];
            snapshot.forEach((doc) => {
                guestResponses.push({ id: doc.id, ...doc.data() });
            });
            updateAdminStats();
        });
    };

    // Update UI
    const updateUI = () => {
        const container = document.getElementById('app-container');
        const isAdmin = currentUser && currentUser.email === ADMIN_EMAIL;
        const t = translations[currentLanguage]; // Get current language strings

        if (!currentUser) {
            container.innerHTML = `
                <div class="glass-card rounded-3xl p-12 text-center max-w-md mx-auto">
                    <img src="./assets/logo-ganesh.png" alt="Lord Ganesha" class="w-16 h-auto mx-auto mb-6" onerror="this.onerror=null;this.src='https://placehold.co/96x96/8B0000/FFFFFF?text=G+Logo'">
                    <h3 class="text-3xl font-display text-royal-maroon mb-4">${t.welcome}</h3>
                    <p class="text-gray-700 mb-8 font-body text-lg">${t.signin}</p>
                    <button onclick="signInWithGoogle()" class="btn-royal text-white px-8 py-4 rounded-full font-sans font-medium shadow-lg w-full">
                        <i class="fab fa-google mr-3"></i>Sign in with Google
                    </button>
                </div>
            `;
            return;
        }

        container.innerHTML = `
            <!-- 4. Language Toggle Button -->
            <div class="text-right mb-4">
                <button onclick="toggleLanguage()" class="bg-gold/20 text-royal-maroon px-3 py-1 rounded-full text-sm font-sans font-medium hover:bg-gold/40 transition">
                    <i class="fas fa-language mr-1"></i> ${currentLanguage === 'en' ? 'Switch to Hindi' : 'अंग्रेजी में बदलें'}
                </button>
            </div>

            <div class="glass-card rounded-3xl overflow-hidden">
                <!-- User Header -->
                <div class="bg-gradient-to-r from-royal-maroon to-rose-gold p-6 text-white">
                    <div class="flex justify-between items-center flex-wrap gap-4">
                        <div>
                            <p class="text-sm opacity-90">Welcome back,</p>
                            <p class="text-xl font-display font-semibold">${currentUser.displayName || currentUser.email}</p>
                        </div>
                        <button onclick="signOutUser()" class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-full text-sm transition">
                            Sign Out
                        </button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="border-b border-gray-200 px-6 bg-white/50">
                    <div class="flex gap-2 overflow-x-auto">
                        <button onclick="switchTab('rsvp')" class="tab-button active text-royal-maroon font-semibold px-6 py-4 font-sans">
                            <i class="fas fa-envelope mr-2"></i>${t.rsvp_tab}
                        </button>
                        <!-- Consolidated Schedule and Dress Code tab -->
                        <button onclick="switchTab('details')" class="tab-button text-gray-600 px-6 py-4 font-sans">
                            <i class="fas fa-calendar-alt mr-2"></i>${t.details_tab}
                        </button>
                        ${isAdmin ? `<button onclick="switchTab('admin')" class="tab-button text-gray-600 px-6 py-4 font-sans">
                            <i class="fas fa-chart-bar mr-2"></i>Admin
                        </button>` : ''}
                    </div>
                </div>

                <!-- Tab Content -->
                <div class="p-6 md:p-10">
                    <div id="tab-rsvp" class="tab-content">${renderRSVP()}</div>
                    <div id="tab-details" class="tab-content hidden">${renderDetails()}</div>
                    ${isAdmin ? `<div id="tab-admin" class="tab-content hidden">${renderAdmin()}</div>` : ''}
                </div>
            </div>
        `;
        // Ensure the correct tab is active and language content is set
        if (activeTab) switchTab(activeTab);
        updateLanguageContent();
    };

    // Helper for Performance input toggle and Dynamic Travel Input
    window.onload = () => {
        updateCountdown();
        setRsvpDeadline(); 
        updateUI();
        
        // Event delegation for input changes
        document.addEventListener('change', (e) => {
            const isPerformingEl = document.getElementById('isPerforming');
            const travelArrangementEl = document.querySelector('select[name="travelArrangement"]');

            // Toggle Performance details
            if (e.target === isPerformingEl) {
                const isChecked = isPerformingEl.checked;
                document.getElementById('performanceType').disabled = !isChecked;
                document.getElementById('performanceTime').disabled = !isChecked;
                document.getElementById('performanceWhatsapp').disabled = !isChecked;
                if (isChecked) {
                    document.getElementById('performanceType').focus();
                }
            }
            
            // 5. Toggle Travel Destination Input
            if (e.target === travelArrangementEl) {
                const travelType = travelArrangementEl.value;
                const dynamicInput = document.getElementById('dynamicTravelInput');
                
                if (travelType === 'Airport' || travelType === 'Train') {
                    const labelText = travelType === 'Airport' ? 'Airport Name (e.g., Delhi IGI)' : 'Train Station Name (e.g., Sikar Junction)';
                    dynamicInput.innerHTML = `
                        <label class="block text-sm font-sans font-medium text-gray-700 mb-2">${labelText} *</label>
                        <input type="text" name="travelStation" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition" placeholder="${labelText}">
                    `;
                } else {
                    dynamicInput.innerHTML = '';
                }
            }
        });
    };

    // RSVP Form
    const renderRSVP = () => {
        const disabledAttr = 'disabled';
        const now = new Date().getTime();
        const showPerformance = now >= PERFORMANCE_CUTOFF_DATE;

        return `
            <div class="max-w-3xl mx-auto">
                <h2 class="text-4xl font-display text-royal-maroon mb-8 text-center">Your Presence is Requested</h2>
                
                <form id="rsvp-form" class="space-y-6">
                    <!-- Basic Info -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Full Name *</label>
                            <input type="text" name="name" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                        </div>
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Mobile Number *</label>
                            <input type="tel" name="mobile" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition" placeholder="+91-XXXXXXXXXX">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Email Address *</label>
                        <input type="email" name="email" value="${currentUser.email}" readonly class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-gray-50">
                    </div>
                    
                    <!-- Side and Attendance -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Which side are you from? *</label>
                            <select name="side" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                                <option value="">Select...</option>
                                <option value="Groom">Groom's Side (Harsh)</option>
                                <option value="Bride">Bride's Side (Twinkle)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Will you attend the wedding? *</label>
                            <select name="attending" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                                <option value="">Select...</option>
                                <option value="Yes">Yes, I'll be there! 🎉</option>
                                <option value="No">Regretfully, I cannot attend</option>
                            </select>
                        </div>
                    </div>

                    <!-- Events Checkbox -->
                    <div>
                        <label class="block text-sm font-sans font-medium text-gray-700 mb-3">Which events will you attend? *</label>
                        <div class="space-y-3">
                            <label class="flex items-center p-3 rounded-xl hover:bg-gold/10 transition cursor-pointer">
                                <input type="checkbox" name="events" value="Haldi" class="w-5 h-5 text-royal-maroon rounded">
                                <span class="ml-3">Nov 29: Haldi Ceremony</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl hover:bg-gold/10 transition cursor-pointer">
                                <input type="checkbox" name="events" value="Sangeet" class="w-5 h-5 text-royal-maroon rounded">
                                <span class="ml-3">Nov 29: Sangeet Night & Performances</span>
                            </label>
                            <label class="flex items-center p-3 rounded-xl hover:bg-gold/10 transition cursor-pointer">
                                <input type="checkbox" name="events" value="Wedding" class="w-5 h-5 text-royal-maroon rounded">
                                <span class="ml-3">Nov 30: Wedding Ceremony & Reception</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Travel & Accommodation -->
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Need Accommodation? *</label>
                            <select name="accommodation" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                                <option value="No">No, I'll arrange my own</option>
                                <option value="Yes">Yes, please arrange</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Number of Guests (Including you)</label>
                            <input type="number" name="guests" min="1" value="1" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                        </div>
                    </div>
                    
                    <!-- Travel Arrangement Fields (3. Added Arrival Time) -->
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="md:col-span-2">
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Travel Arrangement/Pick-up Needed? *</label>
                            <select name="travelArrangement" required class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                                <option value="None">No, self-arranged travel</option>
                                <option value="Airport">Pick-up from Airport</option>
                                <option value="Train">Pick-up from Train Station</option>
                                <option value="Road">Need Road Travel Assistance</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Arrival Date</label>
                            <input type="date" name="arrivalDate" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                        </div>
                        
                        <div id="dynamicTravelInput" class="md:col-span-3">
                            <!-- 5. Dynamic input field for Airport/Station Name will be inserted here by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- 3. Arrival Time Field (moved outside of the grid to ensure it's always visible for date) -->
                    <div>
                        <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Approximate Arrival Time</label>
                        <input type="time" name="arrivalTime" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition">
                    </div>


                    <!-- 2. Reception Performance (Conditional based on date) -->
                    <div id="performanceSection" class="space-y-6 ${showPerformance ? '' : 'hidden'}">
                        <div class="glass-card p-6 rounded-xl border-2 border-rose-gold/30">
                            <h3 class="text-xl font-display text-royal-maroon mb-4">Sangeet Performance Registration</h3>
                            <label class="flex items-center font-sans font-medium text-gray-700 mb-4 cursor-pointer">
                                <input type="checkbox" name="isPerforming" id="isPerforming" class="w-5 h-5 text-royal-maroon rounded">
                                <span class="ml-3 font-semibold text-lg text-royal-maroon">I would like to give a performance</span>
                            </label>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Performance Type</label>
                                    <select name="performanceType" id="performanceType" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition disabled:bg-gray-100" ${disabledAttr}>
                                        <option value="Dance">Dance</option>
                                        <option value="Song">Song/Singing</option>
                                        <option value="Poetry">Poetry/Skit</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Time (minutes)</label>
                                    <input type="number" name="performanceTime" id="performanceTime" min="1" max="10" value="3" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition disabled:bg-gray-100" ${disabledAttr}>
                                </div>
                                <div>
                                    <label class="block text-sm font-sans font-medium text-gray-700 mb-2">WhatsApp Contact for Coord.</label>
                                    <input type="tel" name="performanceWhatsapp" id="performanceWhatsapp" placeholder="+91-XXXXXXXXXX" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition disabled:bg-gray-100" ${disabledAttr}>
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div>
                        <label class="block text-sm font-sans font-medium text-gray-700 mb-2">Special Requests or Dietary Requirements</label>
                        <textarea name="notes" rows="3" class="w-full px-4 py-3 rounded-xl border-2 border-gray-200 transition" placeholder="Let us know if you have any special needs..."></textarea>
                    </div>

                    <div id="form-message" class="hidden"></div>

                    <button type="submit" class="btn-royal w-full py-4 rounded-xl text-white font-sans font-medium text-lg shadow-xl">
                        Submit RSVP
                    </button>
                </form>
            </div>
        `;
    };

    // Consolidated Itinerary & Dress Code Page
    const renderDetails = () => {
        return `
            <div class="max-w-4xl mx-auto">
                <h2 class="text-4xl font-display text-royal-maroon mb-4 text-center">Itinerary & Dress Code Guide</h2>
                <p class="text-center text-gray-600 mb-10 font-body text-lg">Your guide to all events, times, and suggested attire.</p>

                <!-- Video Invitation -->
                <div class="mb-12 rounded-2xl overflow-hidden shadow-2xl relative">
                    <div class="video-overlay absolute inset-0 pointer-events-none z-10"></div>
                    <video controls class="w-full" poster="https://placehold.co/800x450/8B0000/FFFFFF?text=Wedding+Invitation">
                        <source src="./assets/video-invite.mp4" type="video/mp4">
                    </video>
                </div>

                <!-- Event Schedule & Dress Code -->
                <div class="space-y-8 mb-12">
                    <!-- Day 1: Haldi & Sangeet -->
                    <div class="glass-card rounded-2xl p-8">
                        <h3 class="text-2xl font-display text-royal-maroon mb-4 border-b pb-2">Friday, November 29</h3>
                        
                        <!-- Haldi -->
                        <div class="mb-4">
                            <h4 class="text-xl font-semibold text-rose-gold flex items-center"><i class="fas fa-sun mr-3 w-5 text-gold"></i>12:15 PM: Haldi Ceremony</h4>
                            <p class="mt-2 ml-8 text-gray-700"><strong>Dress Code: Pastel (Light Colours).</strong> Please avoid deep yellow and green colors.</p>
                        </div>
                        
                        <!-- Sangeet -->
                        <div>
                            <h4 class="text-xl font-semibold text-rose-gold flex items-center"><i class="fas fa-microphone-alt mr-3 w-5 text-gold"></i>7:00 PM: Sangeet Night & Performances</h4>
                            <p class="mt-2 ml-8 text-gray-700"><strong>Dress Code: Bring your glaze and bring the fun!</strong> Indo-Western or Cocktail Attire encouraged.</p>
                        </div>
                    </div>

                    <!-- Day 2: Myra & Wedding -->
                    <div class="glass-card rounded-2xl p-8">
                        <h3 class="text-2xl font-display text-royal-maroon mb-4 border-b pb-2">Saturday, November 30</h3>
                        
                        <!-- Myra -->
                        <div class="mb-4">
                            <h4 class="text-xl font-semibold text-rose-gold flex items-center"><i class="fas fa-hands-helping mr-3 w-5 text-gold"></i>11:00 AM: Myra Ceremony</h4>
                            <p class="mt-2 ml-8 text-gray-700"><strong>Dress Code: Traditional Ethnic.</strong> Women: Rajputi Dress. Men: Traditional Ethnic Wear.</p>
                        </div>
                        
                        <!-- Wedding -->
                        <div>
                            <h4 class="text-xl font-semibold text-rose-gold flex items-center"><i class="fas fa-crown mr-3 w-5 text-gold"></i>7:30 PM: Wedding Ceremony, Reception & Grand Dinner</h4>
                            <p class="mt-2 ml-8 text-gray-700"><strong>Dress Code: Bring the Royal attire out!</strong> Formal Indian Attire is suggested.</p>
                        </div>
                    </div>
                </div>

                <div class="divider">
                    <span class="ornament w-8 h-8 inline-block"></span>
                </div>

                <!-- Venue & Contact -->
                <div class="grid md:grid-cols-2 gap-6 mt-12">
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <i class="fas fa-map-marker-alt text-4xl text-gold mb-4"></i>
                        <h3 class="text-xl font-display text-royal-maroon mb-3">Venue</h3>
                        <p class="text-gray-700 mb-4">Govindam Gopinath Sewa Sadan<br>Nehru Garden, Sikar Road<br>Sikar, Rajasthan 332001</p>
                        <a href="https://www.google.com/maps/search/?api=1&query=GOVINDAM+GOPINATH+SEWA+SADAN,+Sikar" target="_blank" class="inline-block bg-royal-maroon text-white px-6 py-3 rounded-full hover:bg-opacity-90 transition">
                            Get Directions
                        </a>
                    </div>

                    <!-- Coordinator Update (Mobile No. 9743116904) -->
                    <div class="glass-card rounded-2xl p-8 text-center">
                        <i class="fas fa-phone-alt text-4xl text-gold mb-4"></i>
                        <h3 class="text-xl font-display text-royal-maroon mb-3">Contact</h3>
                        <p class="text-gray-700 mb-2">Wedding Coordinator</p>
                        <p class="font-semibold text-lg mb-4">Umesh Pareek</p>
                        <a href="tel:+919743116904" class="inline-block bg-royal-maroon text-white px-6 py-3 rounded-full hover:bg-opacity-90 transition">
                            <i class="fas fa-phone mr-2"></i>+91-9743116904
                        </a>
                    </div>
                </div>

                <!-- Final Message (Moved here and styled italic) -->
                <div class="mt-12 p-6 max-w-4xl mx-auto bg-rose-gold/10 rounded-2xl border border-rose-gold/30">
                    <p class="font-sans text-lg text-royal-maroon font-medium italic">
                        We want you at the wedding! If you are not able to follow the dress code guidelines precisely, **please don't stress about it**. Just be part of the family and enjoy the wedding.
                    </p>
                </div>
            </div>
        `;
    };

    // Admin Dashboard
    const renderAdmin = () => {
        return `
            <div class="max-w-5xl mx-auto">
                <h2 class="text-4xl font-display text-royal-maroon mb-8 text-center">Admin Dashboard</h2>
                
                <div id="admin-stats" class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <!-- Stats will be updated by updateAdminStats -->
                </div>

                <div class="glass-card rounded-2xl p-8">
                    <h3 class="text-2xl font-display text-royal-maroon mb-6">Export Reports</h3>
                    <div class="grid md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <button onclick="exportCSV('all')" class="bg-green-600 hover:bg-green-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-file-excel mr-2"></i>All RSVPs
                        </button>
                        <button onclick="exportCSV('attending')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-users mr-2"></i>Attending Guests
                        </button>
                        <button onclick="exportCSV('groom-side')" class="bg-red-600 hover:bg-red-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-male mr-2"></i>Groom's Side
                        </button>
                        <button onclick="exportCSV('bride-side')" class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-female mr-2"></i>Bride's Side
                        </button>
                        <button onclick="exportCSV('accommodation')" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-hotel mr-2"></i>Accommodation
                        </button>
                        <button onclick="exportCSV('travel-pickups')" class="bg-orange-600 hover:bg-orange-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-car mr-2"></i>Travel Pickups
                        </button>
                        <button onclick="exportCSV('performers')" class="bg-teal-600 hover:bg-teal-700 text-white px-6 py-4 rounded-xl transition">
                            <i class="fas fa-microphone-alt mr-2"></i>Performers List
                        </button>
                    </div>
                </div>

                <div class="glass-card rounded-2xl p-8 mt-6">
                    <h3 class="text-2xl font-display text-royal-maroon mb-4">Recent RSVPs</h3>
                    <div id="recent-rsvps" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">No RSVPs yet</p>
                    </div>
                </div>
            </div>
        `;
    };

    // Update Admin Stats
    const updateAdminStats = () => {
        if (!document.getElementById('admin-stats')) return;
        
        const attending = guestResponses.filter(r => r.attending === 'Yes').length;
        const accommodation = guestResponses.filter(r => r.accommodation === 'Yes').length;
        const totalGuests = guestResponses.reduce((sum, r) => sum + (parseInt(r.guests) || 1), 0);
        
        document.getElementById('admin-stats').innerHTML = `
            <div class="glass-card rounded-xl p-6 text-center">
                <div class="text-3xl font-display font-bold text-royal-maroon">${guestResponses.length}</div>
                <div class="text-sm text-gray-600 mt-2">Total RSVPs</div>
            </div>
            <div class="glass-card rounded-xl p-6 text-center">
                <div class="text-3xl font-display font-bold text-green-600">${attending}</div>
                <div class="text-sm text-gray-600 mt-2">Attending</div>
            </div>
            <div class="glass-card rounded-xl p-6 text-center">
                <div class="text-3xl font-display font-bold text-blue-600">${accommodation}</div>
                <div class="text-sm text-gray-600 mt-2">Need Accommodation</div>
            </div>
            <div class="glass-card rounded-xl p-6 text-center">
                <div class="text-3xl font-display font-bold text-purple-600">${totalGuests}</div>
                <div class="text-sm text-gray-600 mt-2">Total Guests</div>
            </div>
        `;

        // Update recent RSVPs
        const recentDiv = document.getElementById('recent-rsvps');
        if (recentDiv && guestResponses.length > 0) {
             recentDiv.innerHTML = guestResponses.slice(-5).reverse().map(r => `
                <div class="flex justify-between items-center p-4 bg-gray-50 rounded-lg">
                    <div>
                        <p class="font-semibold">${r.name}</p>
                        <p class="text-sm text-gray-600">${r.email} - <span class="${r.side === 'Groom' ? 'text-blue-500' : 'text-pink-500'}">${r.side || 'N/A'} Side</span></p>
                    </div>
                    <span class="px-3 py-1 rounded-full text-sm ${r.attending === 'Yes' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}">
                        ${r.attending === 'Yes' ? 'Attending' : 'Not Attending'}
                    </span>
                </div>
            `).join('');
        }
    };

    // Handle RSVP Submit
    document.addEventListener('submit', async (e) => {
        if (e.target.id === 'rsvp-form') {
            e.preventDefault();
            const form = e.target;
            const submitBtn = form.querySelector('button[type="submit"]');
            const messageDiv = document.getElementById('form-message');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const formData = new FormData(form);
            const events = [];
            formData.getAll('events').forEach(e => events.push(e));
            
            const isPerforming = formData.get('isPerforming') === 'on';

            const data = {
                name: formData.get('name'),
                mobile: formData.get('mobile'),
                email: currentUser.email,
                side: formData.get('side'),
                attending: formData.get('attending'),
                events: events,
                accommodation: formData.get('accommodation'),
                guests: parseInt(formData.get('guests')) || 1,
                travelArrangement: formData.get('travelArrangement'),
                arrivalDate: formData.get('arrivalDate'),
                arrivalTime: formData.get('arrivalTime'), // 3. NEW: Arrival Time
                travelStation: formData.get('travelStation') || '', // 5. NEW: Station/Airport Name
                isPerforming: isPerforming,
                // PERFORMANCE FIELDS
                performanceType: isPerforming ? formData.get('performanceType') : '',
                performanceTime: isPerforming ? parseInt(formData.get('performanceTime')) || 0 : 0,
                performanceWhatsapp: isPerforming ? formData.get('performanceWhatsapp') : '',
                notes: formData.get('notes'),
                timestamp: serverTimestamp(),
                uid: currentUser.uid
            };

            try {
                const docId = btoa(currentUser.uid);
                await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'wedding_rsvps', docId), data, { merge: true });
                
                messageDiv.className = 'bg-green-50 border-l-4 border-green-500 p-4 rounded-lg mb-4';
                messageDiv.innerHTML = `
                    <p class="font-semibold text-green-800">✨ RSVP Submitted Successfully!</p>
                    <p class="text-green-700 text-sm mt-1">Thank you for confirming. We can't wait to celebrate with you!</p>
                `;
                messageDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 5000);
                
            } catch (error) {
                console.error(error);
                messageDiv.className = 'bg-red-50 border-l-4 border-red-500 p-4 rounded-lg mb-4';
                messageDiv.innerHTML = `
                    <p class="font-semibold text-red-800">Submission Failed</p>
                    <p class="text-red-700 text-sm mt-1">${error.message}</p>
                `;
                messageDiv.classList.remove('hidden');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit RSVP';
            }
        }
    });

    // CSV Export (Updated to include new fields)
    window.exportCSV = (type) => {
        if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
            console.error('Access denied');
            return;
        }

        let data = [];
        let filename = '';
        
        // Helper function for mapping all necessary fields
        const mapRsvpToData = (r) => ({
            Name: r.name,
            Side: r.side,
            Email: r.email,
            Mobile: r.mobile,
            Guests: r.guests,
            Attending: r.attending,
            Events: (r.events || []).join(', '),
            Accommodation: r.accommodation,
            Travel_Arrangement: r.travelArrangement || 'None',
            Arrival_Date: r.arrivalDate || 'N/A',
            Arrival_Time: r.arrivalTime || 'N/A', // NEW
            Travel_Station: r.travelStation || 'N/A', // NEW
            Performing: r.isPerforming ? 'Yes' : 'No', 
            Performance_Type: r.performanceType || '',
            Performance_Time: r.performanceTime || 0,
            Performance_WhatsApp: r.performanceWhatsapp || '',
            Notes: r.notes || ''
        });

        switch(type) {
            case 'all':
                data = guestResponses.map(mapRsvpToData);
                filename = 'All_RSVPs';
                break;
            case 'attending':
                data = guestResponses.filter(r => r.attending === 'Yes').map(mapRsvpToData);
                filename = 'Attending_Guests';
                break;
            case 'groom-side': 
                data = guestResponses.filter(r => r.attending === 'Yes' && r.side === 'Groom').map(mapRsvpToData);
                filename = 'Groom_Side_Guests';
                break;
            case 'bride-side': 
                data = guestResponses.filter(r => r.attending === 'Yes' && r.side === 'Bride').map(mapRsvpToData);
                filename = 'Bride_Side_Guests';
                break;
            case 'accommodation':
                data = guestResponses.filter(r => r.accommodation === 'Yes').map(mapRsvpToData);
                filename = 'Accommodation_Required';
                break;
            case 'travel-pickups':
                data = guestResponses.filter(r => r.attending === 'Yes' && r.travelArrangement !== 'None').map(r => ({
                    Name: r.name,
                    Side: r.side,
                    Mobile: r.mobile,
                    Guests: r.guests,
                    Arrangement_Type: r.travelArrangement,
                    Station_Name: r.travelStation || 'Not Specified', // NEW
                    Arrival_Date: r.arrivalDate || 'Not Specified',
                    Arrival_Time: r.arrivalTime || 'Not Specified', // NEW
                    Notes: r.notes || ''
                }));
                filename = 'Travel_Pickup_Requests';
                break;
            case 'performers':
                data = guestResponses.filter(r => r.isPerforming).map(r => ({
                    Name: r.name,
                    Side: r.side,
                    Mobile: r.mobile,
                    Performance_Type: r.performanceType || 'Unspecified',
                    Performance_Time_Min: r.performanceTime || 0,
                    Performance_WhatsApp: r.performanceWhatsapp || 'None provided',
                    Event: (r.events || []).join(', ')
                }));
                filename = 'Reception_Performers';
                break;
            case 'events':
                const eventCounts = { Haldi: 0, Sangeet: 0, Wedding: 0 };
                guestResponses.forEach(r => {
                    if (r.attending === 'Yes' && r.events) {
                        r.events.forEach(e => {
                            if (eventCounts[e] !== undefined) eventCounts[e]++;
                        });
                    }
                });
                data = Object.entries(eventCounts).map(([event, count]) => ({ Event: event, Count: count }));
                filename = 'Event_Counts';
                break;
        }

        if (data.length === 0) {
            console.log('No data to export for this selection.');
            return;
        }

        const headers = Object.keys(data[0]);
        const csv = [
            headers.join(','),
            ...data.map(row => headers.map(h => `"${(row[h] || '').toString().replace(/"/g, '""')}"`).join(','))
        ].join('\n');

        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${filename}_${new Date().toISOString().slice(0,10)}.csv`;
        a.click();
        URL.revokeObjectURL(url); 
    };
</script>

<div class="min-h-screen royal-pattern py-8 px-4">
    <div class="max-w-6xl mx-auto">
        <!-- Hero Header -->
        <header class="text-center mb-12">
            
            <!-- Ganesha Logo -->
            <img src="./assets/logo-ganesh.png" alt="Lord Ganesha" class="w-24 h-auto mx-auto mb-6 floating" onerror="this.onerror=null;this.src='https://placehold.co/96x96/8B0000/FFFFFF?text=G+Logo'">

            
            <div class="mb-4">
                <p id="invite-header" class="text-gold font-sans text-sm uppercase tracking-widest mb-2">You Are Invited To Celebrate</p>
            </div>
            
            <h1 id="hero-title" class="hero-title font-display font-bold mb-6">
                Harsh & Twinkle
            </h1>
            
            <!-- TH Logo as Separator (Size increased via .th-logo CSS) -->
            <div class="flex items-center justify-center gap-4 mb-8">
                <div class="h-px w-20 bg-gradient-to-r from-transparent to-gold"></div>
                <img src="./assets/logo-th.png" alt="TH" class="th-logo" onerror="this.onerror=null;this.src='https://placehold.co/80x80/B76E79/FFFFFF?text=TH'">
                <div class="h-px w-20 bg-gradient-to-l from-transparent to-gold"></div>
            </div>
            
            <p class="text-xl md:text-2xl font-body text-gray-700 mb-8">
                November 29-30, 2025<br>
                <span class="text-base text-gray-600">Sikar, Rajasthan</span>
            </p>

            <!-- Countdown -->
            <div id="countdown" class="mb-8"></div>

            <!-- Family Message (1. Removed "son" part) -->
            <div class="glass-card rounded-3xl p-8 md:p-12 max-w-3xl mx-auto">
                <p id="family-message-content" class="text-lg md:text-xl font-body text-gray-700 leading-relaxed italic">
                    With hearts full of joy and gratitude, the <strong class="text-royal-maroon">Pareek family</strong> 
                    invite you to witness and bless the sacred union of <strong class="text-royal-maroon">Harsh</strong> 
                    with <strong class="text-royal-maroon">Twinkle</strong>. Your presence will make this celebration truly complete.
                </p>
            </div>
            
             <!-- Removed the final message from the header. It is now on the Details page. -->
        </header>

        <!-- Main App Container -->
        <div id="app-container">
            <div class="glass-card rounded-3xl p-12 text-center max-w-md mx-auto">
                <div class="ornament w-16 h-16 mx-auto mb-6"></div>
                <h3 class="text-3xl font-display text-royal-maroon mb-4">Loading...</h3>
                <div class="flex justify-center">
                    <div class="animate-spin rounded-full h-12 w-12 border-4 border-gold border-t-transparent"></div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="text-center mt-16 pb-8">
            <div class="ornament w-8 h-8 mx-auto mb-4"></div>
            <!-- FIX: Added ID for JavaScript to insert the dynamic deadline date -->
            <p id="rsvp-deadline" class="text-gray-600 font-body">
                <!-- Date will be inserted by JavaScript -->
            </p>
            <p class="text-sm text-gray-500 mt-2">
                © 2025 Pareek Family | Made with <i class="fas fa-heart text-rose-gold"></i>
            </p>
        </footer>
    </div>
</div>

</body>
</html>
